<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>JB VIN Decoder</title>

    <meta name="color-scheme" content="dark">
    <meta name="theme-color" content="#0b1210">

    <style>
        :root{
          --bg:#0b1210;
          --card:#121c18;
          --row:#0f1714;
          --text:#e9fff4;
          --muted:#9bb0a6;
          --accent:#ff3d00;
          --accent2:#ff6a00;
          --ok:#2fd37b;
          --bad:#ff5d5d;
          --warn:#ffcc66;
        }

        *{box-sizing:border-box}

        body{
          margin:0;
          font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
          background:var(--bg);
          color:var(--text);
        }

        .app{
          max-width:520px;
          margin:0 auto;
          padding:14px;
        }

        .header{text-align:center;padding:12px 0 6px}

        .logo{
          width:56px;height:56px;margin:0 auto 8px;
          border-radius:14px;background:#1a1a1a;
          display:flex;align-items:center;justify-content:center;
          font-weight:900;color:var(--accent)
        }

        .logo img{width:100%;height:100%;object-fit:cover;border-radius:14px}

        h1{margin:4px 0 2px;font-size:18px;font-weight:900}
        .sub{font-size:11px;color:var(--muted)}

        .card{
          background:var(--card);
          border-radius:18px;
          padding:14px;
          margin-top:14px;
        }

        input{
          width:100%;padding:12px;border-radius:14px;
          border:1px solid rgba(255,255,255,.15);
          background:#0c1612;color:var(--text);
          text-transform:uppercase;font-size:14px;
        }

        button{
          width:100%;margin-top:10px;padding:12px;
          border-radius:14px;border:0;font-size:14px;
          font-weight:900;cursor:pointer;
        }

        .primary{background:linear-gradient(180deg,var(--accent),var(--accent2));color:#000}
        .secondary{background:#1a1a1a;color:var(--text);border:1px solid rgba(255,255,255,.15)}

        .status{margin-top:10px;font-size:12px;min-height:18px}
        .status.ok{color:var(--ok)}
        .status.bad{color:var(--bad)}
        .status.warn{color:var(--warn)}

        .vehicle{
          margin-top:14px;padding:12px;border-radius:16px;
          background:linear-gradient(135deg,#141414,#1b1b1b);
          text-align:center;font-weight:900;font-size:17px;display:none;
        }

        .results,.oem{margin-top:12px;display:grid;gap:8px}

        .row{
          display:flex;justify-content:space-between;
          background:var(--row);padding:10px 12px;
          border-radius:12px;border:1px solid rgba(255,255,255,.06);
        }

        .k{font-size:11px;color:var(--muted)}
        .v{font-size:13px;font-weight:800;text-align:right}

        .oem h3{
          font-size:13px;
          margin:6px 0;
          color:var(--accent2);
        }

        .disclaimer{
          margin-top:12px;font-size:10px;color:#888;line-height:1.4;
        }

        .footer{text-align:center;margin-top:16px;font-size:10px;color:#777}
    </style>
</head>

<body>
<div class="app">

    <div class="header">
        <div class="logo">
            <img src="logo.png" onerror="this.remove();this.parentNode.textContent='JB';">
        </div>
        <h1>JB VIN Decoder</h1>
        <div class="sub">Powered by NHTSA vPIC</div>
    </div>

    <div class="card">
    <input id="vin" maxlength="17" placeholder="ENTER 17-CHARACTER VIN">
    <button class="primary" onclick="decode()">Decode VIN</button>
    <button class="secondary" onclick="reset()">Reset</button>
    <button class="secondary" onclick="printPage()">Print</button>

    <div id="status" class="status"></div>
    <div id="vehicle" class="vehicle"></div>
    <div id="results" class="results"></div>

    <div id="oem" class="oem" style="display:none"></div>

    <!-- ✅ ADD WORKFLOW UI RIGHT HERE -->
    <div id="workflow" style="display:none">
        <h3 style="margin-top:0;color:var(--accent2)">
            Parts Counter Guide
        </h3>

        <div id="safe"></div>
        <div id="verify"></div>
        <div id="unsafe"></div>
    </div>
    <!-- ✅ END -->

    <div class="disclaimer">
        OEM compatibility is VIN-matched by configuration.
        Exact part numbers require manufacturer or licensed catalogs.
    </div>
</div>

<script>
/* ===== DOM REFERENCES ===== */
const vinInput = vin;
const statusEl = status;
const resultsEl = results;
const vehicleEl = vehicle;
const oemEl = oem;

let busy = false;

/* ===== BASIC HELPERS ===== */
function clean(v){
  return v.toUpperCase().replace(/[^A-Z0-9]/g,"");
}
function valid(v){
  return v.length === 17 && !/[IOQ]/.test(v);
}

/* ===== CONFIGURATION DETECTORS ===== */
function isCVT(d){ return d.TransmissionStyle?.toLowerCase().includes("cvt"); }
function isAutomatic(d){ return d.TransmissionStyle?.toLowerCase().includes("auto"); }
function isManual(d){ return d.TransmissionStyle?.toLowerCase().includes("manual"); }
function isDiesel(d){ return d.FuelTypePrimary?.toLowerCase().includes("diesel"); }
function isElectric(d){ return d.ElectrificationLevel?.toLowerCase().includes("electric"); }
function isAWD(d){ return d.DriveType?.toLowerCase().includes("awd"); }

/* ===== PROFESSIONAL SCORING ===== */
function confidenceScore(d){
  let s = 0;
  if(d.EngineModel) s+=20;
  if(d.TransmissionStyle) s+=20;
  if(d.DriveType) s+=20;
  if(d.BodyClass) s+=20;
  if(d.PlantCountry) s+=20;
  return s;
}

function orderReadiness(d){
  if(d.EngineModel && d.TransmissionStyle) return "✓ Ready for most mechanical parts";
  return "⚠ Verify configuration before ordering";
}

function platformGroup(d){
  if(d.Make==="TOYOTA" && d.Model==="Corolla") return "Toyota E170 / E180 platform";
  if(d.Make==="HONDA" && d.Model==="Civic") return "Honda Global Small platform";
  return "Platform data unavailable";
}

function sanityCheck(d){
  if(d.Make==="TOYOTA" && d.Model==="Corolla"){
    if(d.EngineModel && !["2ZR-FE","1ZZ-FE"].includes(d.EngineModel)){
      return "⚠ Uncommon engine for Corolla";
    }
  }
  return "✓ VIN configuration consistent";
}

/* ===== UI HELPERS ===== */
function row(k,v){
  if(!v || v==="Not Applicable") return;
  resultsEl.innerHTML +=
    `<div class="row"><div class="k">${k}</div><div class="v">${v}</div></div>`;
}

function oemSection(title,list){
  if(!list.length) return "";
  return `<h3>${title}</h3>` +
    list.map(i =>
      `<div class="row"><div class="k">•</div><div class="v">${i}</div></div>`
    ).join("");
}

/* ===== MAIN DECODE ===== */
async function decode(){
  let v = clean(vinInput.value);
  vinInput.value = v;

  if(!valid(v)){
    statusEl.textContent="Invalid VIN";
    statusEl.className="status bad";
    return;
  }
  if(busy) return;
  busy = true;

  statusEl.textContent="Decoding VIN…";
  statusEl.className="status warn";
  resultsEl.innerHTML="";
  oemEl.innerHTML="";
  oemEl.style.display="none";
  vehicleEl.style.display="none";

  try{
    const r = await fetch(
      `https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVinValuesExtended/${v}?format=json`
    );
    const d = (await r.json()).Results[0];

    /* HEADER */
    vehicleEl.innerHTML =
      `${d.ModelYear} ${d.Make} ${d.Model}<br>
       <span style="font-size:12px;font-weight:600;color:#aaa">
       ${d.EngineModel || "Unknown"} • ${d.TransmissionStyle || "Unknown"} • ${d.DriveType || "Unknown"}
       </span>`;
    vehicleEl.style.display="block";

    /* CORE DATA */
    /* ================== CORE IDENTIFICATION ================== */
row("VIN", v);
row("Model Year", d.ModelYear);
row("Make", d.Make);
row("Model", d.Model);
row("Trim", d.Trim);
row("Series", d.Series);

/* ================== CONFIDENCE / LOGIC ================== */
row("Decode Confidence", `${confidenceScore(d)}%`);
row("VIN Validation", sanityCheck(d));
row("Order Readiness", orderReadiness(d));
row("Platform", platformGroup(d));

/* ================== ENGINE ================== */
row("Engine Displacement", d.DisplacementL ? `${d.DisplacementL} L` : "");
row("Engine Code", d.EngineModel);
row("Engine Configuration", d.EngineConfiguration);
row("Cylinders", d.EngineCylinders);
row("Valves per Cylinder", d.ValvesPerCylinder);
row("Engine Horsepower", d.EngineHP);
row("Fuel Type", d.FuelTypePrimary);
row("Fuel Secondary", d.FuelTypeSecondary);
row("Fuel Delivery", d.FuelDeliveryType);
row("Turbo / Supercharged", d.EnginePowerType);
row("Cooling Type", d.CoolingType);

/* ================== TRANSMISSION ================== */
row("Transmission Style", d.TransmissionStyle);
row("Transmission Speeds", d.TransmissionSpeeds);

/* ================== DRIVETRAIN ================== */
row("Drive Type", d.DriveType);
row("Axles", d.Axles);
row("Differential Type", d.DifferentialType);

/* ================== BODY / CHASSIS ================== */
row("Body Class", d.BodyClass);
row("Doors", d.Doors);
row("Vehicle Type", d.VehicleType);
row("GVWR", d.GVWR);
row("Wheelbase (Short)", d.WheelBaseShort);
row("Wheelbase (Long)", d.WheelBaseLong);

/* ================== DIMENSIONS ================== */
row("Track Width Front", d.TrackWidthFront);
row("Track Width Rear", d.TrackWidthRear);

/* ================== BRAKES / SUSPENSION ================== */
row("Brake System Type", d.BrakeSystemType);
row("Brake System Description", d.BrakeSystemDesc);
row("Steering Location", d.SteeringLocation);
row("Suspension Type Front", d.SuspensionTypeFront);
row("Suspension Type Rear", d.SuspensionTypeRear);

/* ================== SAFETY ================== */
row("ABS", d.ABS);
row("ESC", d.ESC);
row("Traction Control", d.TractionControl);
row("Airbag Locations", d.AirBagLocFront);

/* ================== ELECTRIFICATION ================== */
row("Electrification Level", d.ElectrificationLevel);
row("Battery Type", d.BatteryType);
row("Battery Voltage", d.BatteryVoltage);
row("Battery Cells", d.BatteryCells);
row("Battery Modules", d.BatteryModules);

/* ================== MANUFACTURING ================== */
row("Plant Company", d.PlantCompanyName);
row("Plant City", d.PlantCity);
row("Plant State", d.PlantState);
row("Plant Country", d.PlantCountry);

/* ================== OEM / MARKET ================== */
row("Manufacturer", d.Manufacturer);
row("Market", d.Market);
row("Make ID", d.MakeID);
row("Model ID", d.ModelID);
row("Series ID", d.SeriesID);

/* ================== ADDITIONAL OEM DATA ================== */
row("Bed Length", d.BedLengthIN);
row("Cab Type", d.CabType);
row("Bus Length", d.BusLength);
row("Trailer Type", d.TrailerType);
row("Trailer Body Type", d.TrailerBodyType);
      

    /* VIN-AWARE PARTS */
    const drivetrain = [];
    if(isCVT(d)) drivetrain.push("CVT transmission","Valve body","Belt / chain","TCM");
    else if(isAutomatic(d)) drivetrain.push("Automatic transmission","Torque converter","Solenoids");
    else if(isManual(d)) drivetrain.push("Manual transmission","Clutch","Flywheel");
    if(isAWD(d)) drivetrain.push("Transfer case");

    oemEl.innerHTML = oemSection("Drivetrain (VIN-Aware)", drivetrain);
    oemEl.style.display="block";

    statusEl.textContent="VIN decoded successfully";
    statusEl.className="status ok";

  }catch(e){
    statusEl.textContent="Decode failed";
    statusEl.className="status bad";
  }

  busy=false;
}
</script>

</body>
</html>
